name: Build & Test Workflow

on:
  push:
    branches:
      - main
      - '**'  # Optional: triggers on all branches

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: ğŸ§¾ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ˜ Install SQL Server
      uses: potatoqualitee/mssqlsuite@v1.7
      with:
        install: sqlengine, sqlpackage

    - name: ğŸ§ª Setup test database
      run: |
        sqlcmd -S localhost -U sa -P dbatools.I0 -Q "CREATE DATABASE TestDb;"
        sqlcmd -S localhost -U sa -P dbatools.I0 -d TestDb -Q "SELECT @@version;"

    - name: ğŸ› ï¸ Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: ğŸ“¦ Restore MAUI workloads
      run: dotnet workload restore ./SEGroup5/SEGroup5.csproj

    - name: ğŸ“¥ Restore dependencies
      run: dotnet restore ./SEGroup5/SEGroup5.csproj

    - name: ğŸ—ï¸ Build project
      env:
        ConnectionStrings__TestConnection: ${{ secrets.TestConnection_CONNECTION_STRING }}
      run: dotnet build ./SEGroup5/SEGroup5.csproj --framework net8.0 --configuration Release --no-restore

    - name: âœ… Run tests
      env:
        ConnectionStrings__TestConnection: ${{ secrets.TestConnection_CONNECTION_STRING }}
      run: dotnet test ./SEGroup5.sln --framework net8.0 --no-build
